const data = [
	{
		"name": "3-Year Unlimited Cloud Storage Service Activation Card - Other",
		"description": "Enjoy 3 years of unlimited Cloud storage service with this activation card, which allows you to remotely access your favorite music, movies and other media via a compatible device and enables private file sharing with loved ones.",
		"brand": "Pogoplug",
		"categories": [
			"Best Buy Gift Cards",
			"Entertainment Gift Cards"
		],
		"hierarchicalCategories": {
			"lvl0": "Best Buy Gift Cards",
			"lvl1": "Best Buy Gift Cards > Entertainment Gift Cards"
		},
		"type": "Online data backup",
		"price": 69,
		"price_range": "50 - 100",
		"image": "https://cdn-demo.algolia.com/bestbuy/1696302_sc.jpg",
		"url": "http://www.bestbuy.com/site/3-year-unlimited-cloud-storage-service-activation-card-other/1696302.p?id=1219066776306&skuId=1696302&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": true,
		"popularity": 10000,
		"rating": 2,
		"objectID": "1696302"
	},
	{
		"name": "360fly - Panoramic 360Â° HD Video Camera - Black",
		"description": "Only at Best Buy  This 360fly panoramic 360&#176; HD video camera features Wi-Fi, a Bluetooth LE interface and the included 360fly app (download required), so you can easily shoot, edit, replay and share recorded video footage using a compatible iOS or Android smartphone. Included action camera adaptor lets you use your 360fly camera with your existing 3-prong mounts.",
		"brand": "360fly",
		"categories": [
			"Cameras & Camcorders",
			"Digital Cameras",
			"Point & Shoot Cameras",
			"360 & Panoramic Cameras"
		],
		"hierarchicalCategories": {
			"lvl0": "Cameras & Camcorders",
			"lvl1": "Cameras & Camcorders > Digital Cameras",
			"lvl2": "Cameras & Camcorders > Digital Cameras > Point & Shoot Cameras",
			"lvl3": "Cameras & Camcorders > Digital Cameras > Point & Shoot Cameras > 360 & Panoramic Cameras"
		},
		"type": "Point&#38;shoot camcrder",
		"price": 399.99,
		"price_range": "200 - 500",
		"image": "https://cdn-demo.algolia.com/bestbuy/9131042_rb.jpg",
		"url": "http://www.bestbuy.com/site/360fly-panoramic-360-hd-video-camera-black/9131042.p?id=1219405459683&skuId=9131042&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9999,
		"rating": 5,
		"objectID": "9131042"
	},
	{
		"name": "3DR - Backpack for Solo - Black",
		"description": "3D Robotics Backpack for Solo Drones: Protect your Solo drone and accessories from the elements, wherever your adventures lead you. This Solo drone backpack features a custom-fitted foam interior that prevents the drone from jostling inside. The black exterior is water-resistant, with padded straps for extra comfort.",
		"brand": "3DR",
		"categories": [
			"Toys, Games & Drones",
			"Drones & Accessories",
			"Drone Accessories",
			"Drone Bags & Cases"
		],
		"hierarchicalCategories": {
			"lvl0": "Toys, Games & Drones",
			"lvl1": "Toys, Games & Drones > Drones & Accessories",
			"lvl2": "Toys, Games & Drones > Drones & Accessories > Drone Accessories",
			"lvl3": "Toys, Games & Drones > Drones & Accessories > Drone Accessories > Drone Bags & Cases"
		},
		"type": "Drone accessory",
		"price": 149.95,
		"price_range": "100 - 200",
		"image": "https://cdn-demo.algolia.com/bestbuy/5353024_sb.jpg",
		"url": "http://www.bestbuy.com/site/3dr-backpack-for-solo-black/5353024.p?id=1219650465782&skuId=5353024&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9998,
		"rating": 5,
		"objectID": "5353024"
	},
	{
		"name": "3DR - Propellers for 3DR Solo Drones (2-Pack) - Black",
		"description": "3D Robotics Propellers for Solo Drones: Buy this set of replacement propellers before you need them so you can get back to flying as soon as you damage or lose a propeller. The 1-piece design of these propellers keeps them secure during flight, self-tightening so you can install them in an instant and return to in-air fun.",
		"brand": "3DR",
		"categories": [
			"Toys, Games & Drones",
			"Drones & Accessories",
			"Drone Accessories",
			"Drone Parts"
		],
		"hierarchicalCategories": {
			"lvl0": "Toys, Games & Drones",
			"lvl1": "Toys, Games & Drones > Drones & Accessories",
			"lvl2": "Toys, Games & Drones > Drones & Accessories > Drone Accessories",
			"lvl3": "Toys, Games & Drones > Drones & Accessories > Drone Accessories > Drone Parts"
		},
		"type": "Drone accessory",
		"price": 14.95,
		"price_range": "1 - 50",
		"image": "https://cdn-demo.algolia.com/bestbuy/5357011_rb.jpg",
		"url": "http://www.bestbuy.com/site/3dr-propellers-for-3dr-solo-drones-2-pack-black/5357011.p?id=1219650465778&skuId=5357011&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9997,
		"rating": 2,
		"objectID": "5357011"
	},
	{
		"name": "3DR - Solo Gimbal - Black",
		"description": "3D Robotics Gimbal for Solo Drones: This stabilizing, 3-axis gimbal for the 3DR Solo drone gives you unprecedented remote control over your compatible GoPro action camera (sold separately). Rotate and tilt the camera, start and stop recording, take photos and adjust camera settings &#8212; all while your drone is up to a half mile away. Plus, the gimbal charges your camera in flight so you never miss a shot.",
		"brand": "3DR",
		"categories": [
			"Toys, Games & Drones",
			"Drones & Accessories",
			"Drone Accessories",
			"Gimbals"
		],
		"hierarchicalCategories": {
			"lvl0": "Toys, Games & Drones",
			"lvl1": "Toys, Games & Drones > Drones & Accessories",
			"lvl2": "Toys, Games & Drones > Drones & Accessories > Drone Accessories",
			"lvl3": "Toys, Games & Drones > Drones & Accessories > Drone Accessories > Gimbals"
		},
		"type": "Drone accessory",
		"price": 399.99,
		"price_range": "200 - 500",
		"image": "https://cdn-demo.algolia.com/bestbuy/5352061_rb.jpg",
		"url": "http://www.bestbuy.com/site/3dr-solo-gimbal-black/5352061.p?id=1219650467156&skuId=5352061&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9996,
		"rating": 2,
		"objectID": "5352061"
	},
	{
		"name": "3DR - Solo Smart Rechargeable Battery - Black",
		"description": "3D Robotics Battery for Solo Drones: Instead of waiting for your lone battery to recharge, get back to flying right away with this rechargeable battery for Solo drones. The battery can power your drone for up to 25 minutes with no camera attached, or 20 minutes carrying a camera.",
		"brand": "3DR",
		"categories": [
			"Toys, Games & Drones",
			"Drones & Accessories",
			"Drone Accessories",
			"Drone Batteries"
		],
		"hierarchicalCategories": {
			"lvl0": "Toys, Games & Drones",
			"lvl1": "Toys, Games & Drones > Drones & Accessories",
			"lvl2": "Toys, Games & Drones > Drones & Accessories > Drone Accessories",
			"lvl3": "Toys, Games & Drones > Drones & Accessories > Drone Accessories > Drone Batteries"
		},
		"type": "Drone accessory",
		"price": 149.95,
		"price_range": "100 - 200",
		"image": "https://cdn-demo.algolia.com/bestbuy/5354101_sb.jpg",
		"url": "http://www.bestbuy.com/site/3dr-solo-smart-rechargeable-battery-black/5354101.p?id=1219650465781&skuId=5354101&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9995,
		"rating": 4,
		"objectID": "5354101"
	},
	{
		"name": "3M - Eureka RR Pet Micro Allergen Vacuum Bag for Select Eureka Vacuums (3-Pack)",
		"description": "Equip your Eureka 4800 series vacuum with this odor-absorbent, micro allergen-filtering vacuum bag and help eliminate dust, dander and other airborne allergens as well as undesirable odors from your home.",
		"brand": "3M",
		"categories": [
			"Appliances",
			"Vacuum Bags"
		],
		"hierarchicalCategories": {
			"lvl0": "Appliances",
			"lvl1": "Appliances > Vacuum Bags"
		},
		"type": "Bags",
		"price": 7.99,
		"price_range": "1 - 50",
		"image": "https://cdn-demo.algolia.com/bestbuy/9274741_sb.jpg",
		"url": "http://www.bestbuy.com/site/3m-eureka-rr-pet-micro-allergen-vacuum-bag-for-select-eureka-vacuums-3-pack/9274741.p?id=1218072892585&skuId=9274741&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9994,
		"rating": 3,
		"objectID": "9274741"
	},
	{
		"name": "3M - Filtrete BISSELL Replacement Belt",
		"description": "Replace a worn-out or broken belt with these replacement belts for BISSELL vacuums.",
		"brand": "3M",
		"categories": [
			"Appliances",
			"Vacuum Belts"
		],
		"hierarchicalCategories": {
			"lvl0": "Appliances",
			"lvl1": "Appliances > Vacuum Belts"
		},
		"type": "Belts",
		"price": 4.99,
		"price_range": "1 - 50",
		"image": "https://cdn-demo.algolia.com/bestbuy/8508064_sb.jpg",
		"url": "http://www.bestbuy.com/site/3m-filtrete-bissell-replacement-belt/8508064.p?id=1186005357079&skuId=8508064&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9993,
		"rating": 1,
		"objectID": "8508064"
	},
	{
		"name": "3M - Filtrete Devil Tattoo Vacuum Bag (3-Pack)",
		"description": "Eliminate allergens from your home with these vacuum bags that grab dust, pollen and dust mites.",
		"brand": "3M",
		"categories": [
			"Appliances",
			"Vacuum Bags"
		],
		"hierarchicalCategories": {
			"lvl0": "Appliances",
			"lvl1": "Appliances > Vacuum Bags"
		},
		"type": "Bags",
		"price": 5.99,
		"price_range": "1 - 50",
		"image": "https://cdn-demo.algolia.com/bestbuy/9940451_sb.jpg",
		"url": "http://www.bestbuy.com/site/3m-filtrete-devil-tattoo-vacuum-bag-3-pack/9940451.p?id=1218198436866&skuId=9940451&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9992,
		"rating": 5,
		"objectID": "9940451"
	},
	{
		"name": "3M - Filtrete Eureka R Replacement Belt for Select Eureka Vacuums",
		"description": "This replacement belt lets you get your Eureka 4800 Series upright vacuum running like new.",
		"brand": "3M",
		"categories": [
			"Appliances",
			"Vacuum Belts"
		],
		"hierarchicalCategories": {
			"lvl0": "Appliances",
			"lvl1": "Appliances > Vacuum Belts"
		},
		"type": "Belts",
		"price": 6.99,
		"price_range": "1 - 50",
		"image": "https://cdn-demo.algolia.com/bestbuy/8507948_sb.jpg",
		"url": "http://www.bestbuy.com/site/3m-filtrete-eureka-r-replacement-belt-for-select-eureka-vacuums/8507948.p?id=1186005356352&skuId=8507948&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9991,
		"rating": 1,
		"objectID": "8507948"
	},
	{
		"name": "3M - Filtrete Eureka U Replacement Belt",
		"description": "Keep things running smoothly at home with these replacement vacuum belts on hand in case of a cleaning emergency.",
		"brand": "3M",
		"categories": [
			"Appliances",
			"Vacuum Belts"
		],
		"hierarchicalCategories": {
			"lvl0": "Appliances",
			"lvl1": "Appliances > Vacuum Belts"
		},
		"type": "Belts",
		"price": 2.99,
		"price_range": "1 - 50",
		"image": "https://cdn-demo.algolia.com/bestbuy/8507939_sb.jpg",
		"url": "http://www.bestbuy.com/site/3m-filtrete-eureka-u-replacement-belt/8507939.p?id=1186005356287&skuId=8507939&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9990,
		"rating": 3,
		"objectID": "8507939"
	},
	{
		"name": "3M - Filtrete Hoover A Micro Allergen Vacuum Bag",
		"description": "Rid your home of allergens with these vacuum bags that grab dust, pollen and dust mites.",
		"brand": "3M",
		"categories": [
			"Appliances",
			"Vacuum Bags"
		],
		"hierarchicalCategories": {
			"lvl0": "Appliances",
			"lvl1": "Appliances > Vacuum Bags"
		},
		"type": "Bags",
		"price": 6.99,
		"price_range": "1 - 50",
		"image": "https://cdn-demo.algolia.com/bestbuy/8507644_sb.jpg",
		"url": "http://www.bestbuy.com/site/3m-filtrete-hoover-a-micro-allergen-vacuum-bag/8507644.p?id=1186005355618&skuId=8507644&cmp=RMX&ky=1uWSHMdQqBeVJB9cXgEke60s5EjfS6M1W",
		"free_shipping": false,
		"popularity": 9989,
		"rating": 5,
		"objectID": "8507644"
	}
];


// Taken 5 objects from the array to test with
const dataSlice = data.slice(0,5);
// initializing an empty array to save categories from each object 
let category = [];
dataSlice.forEach(data => {
	category.push(...data.categories);
});

// To avoid duplicate category after sum up categories from all objects
category = [...new Set(category)];

// initialize the content array with first 5 objects from json
let content = [];
let checkboxValues = [];
let allCategories = [];
let allBrands = [];

dataSlice.forEach(data => {
	allCategories.push(...data.categories);
	allBrands.push(data.brand);
});
// countsObjects is the key value pair for Category name and Item present in particular category
let countCategoryObject = {};
let countBrandObject = {};
let newFilteredBrands = {};
allCategories.forEach(x => countCategoryObject[x] = (countCategoryObject[x] || 0)+1 );
allBrands.forEach(x=> countBrandObject[x] = (countBrandObject[x] || 0)+1);
console.log(countBrandObject);
let countCategoryValues = Object.values(countCategoryObject);


let brand = dataSlice.map(data=> data.brand);
brand = [...new Set(brand)];

// When user clicks on checkbox, we filter the results
const handleChangeCategory = (checkbox) => {
	let categories = document.querySelector("#category-list");
	let categroiesListChecked = categories.querySelectorAll('input[type=checkbox]:checked');

	if(!categroiesListChecked.length) {
		content = [];
		newFilteredBrands = calculateCurrentBrands(dataSlice);
		document.getElementById("brand-list").innerHTML = `${brandTemplate(newFilteredBrands)}`;
		document.getElementById("product-list").innerHTML = `${productListTemplate(dataSlice)}`;
	}
	else if(checkbox.checked === true){
		let filterContent = dataSlice.filter(data => {
			return data.categories ? (data.categories.some(eachCategory => {
				if(eachCategory === checkbox.value){
					return true;
				}
			})) : null;
		});
		filterContent.map(eachResult => {
			// pushing filtered result to temporary array `content`
			content.push(eachResult);
		});
		// Avoid duplicate when clicking multiple times on single checkbox
		content = [...new Set(content)];

		newFilteredBrands = calculateCurrentBrands(content);
		//console.log("brand"+ brand);
		document.getElementById("brand-list").innerHTML = `${brandTemplate(newFilteredBrands)}`;
		document.getElementById("product-list").innerHTML = `${productListTemplate(content)}`;
	}
	else if(checkbox.checked === false){
		content = [];
		//console.log("button checked out ",content);
		let checkboxes = document.querySelectorAll('input[type=checkbox]:checked');
		//console.log("number of checked boxes ",checkboxes);
		checkboxValues = [];
		for (let i = 0; i < checkboxes.length; i++) {
			checkboxValues.push(checkboxes[i].value);
		}
		//console.log("Checkboxes values: ", checkboxValues);
		let filterContent = dataSlice.filter(data => {
			return data.categories ? (data.categories.some(eachCategory => {
				for(let j=0;j<checkboxValues.length;j++){
					if(eachCategory === checkboxValues[j]){
						return true;
					}
				}
			})) : null;
		});

		filterContent.map(eachData => {
			content.push(eachData);
		});

		newFilteredBrands = calculateCurrentBrands(content);
		document.getElementById("brand-list").innerHTML = `${brandTemplate(newFilteredBrands)}`;
		//console.log("latest content after checkedout", content);
		document.getElementById("product-list").innerHTML = `${productListTemplate(content)}`;

	}
};

const handleChangeBrand = checkbox => {

	let categories = document.querySelector("#category-list");
	let categroiesListChecked = categories.querySelectorAll('input[type=checkbox]:checked');

	let brands = document.querySelector("#brand-list");
	let brandListChecked = brands.querySelectorAll('input[type=checkbox]:checked');
	if(!brandListChecked.length && !categroiesListChecked.length) {
		content = [];
		document.getElementById("product-list").innerHTML = `${productListTemplate(dataSlice)}`;
	}
	else if(checkbox.checked === true){
		let filterContent = categroiesListChecked.length ? (
			content.filter(data => {
				return data.brand === checkbox.value;
			})
		) : (
			dataSlice.filter(data => {
				return data.brand === checkbox.value;
			})
		);
		content = [];
		filterContent.map(eachData => {
			content.push(eachData);
		});

		// Avoid duplicate when clicking multiple times on single checkbox
		content = [...new Set(content)];

		document.getElementById("product-list").innerHTML = `${productListTemplate(content)}`;
	}
	else if(!checkbox.checked){
		content = [];
		//console.log("button checked out ",content);
		//console.log("number of checked boxes ",checkboxes);
		if(!brandListChecked.length && categroiesListChecked.length){
			checkboxValues = [];
			for (let i = 0; i < categroiesListChecked.length; i++) {
				checkboxValues.push(categroiesListChecked[i].value);
			}
			//console.log("Checkboxes values: ", checkboxValues);
			let filterContent = dataSlice.filter(data => {
				return data.categories ? (data.categories.some(eachCategory => {
					for(let j=0;j<checkboxValues.length;j++){
						if(eachCategory === checkboxValues[j]){
							return true;
						}
					}
				})) : null;
			});
			filterContent.map(eachData => {
				content.push(eachData);
			});
			document.getElementById("product-list").innerHTML = `${productListTemplate(content)}`;
			console.log("new Contents " + content);
		} else {
			checkboxValues = [];
			for (let i = 0; i < brandListChecked.length; i++) {
				checkboxValues.push(brandListChecked[i].value);
			}
			//console.log("Checkboxes values: ", checkboxValues);
			let filterContent = dataSlice.filter(data => {
				for(let j=0;j<checkboxValues.length;j++){
					if(data.brand === checkboxValues[j]){
						return true;
					}
				}
			});
			filterContent.map(eachData => {
				content.push(eachData);
			});
		}
		//console.log("latest content after checkedout", content);
		document.getElementById("product-list").innerHTML = `${productListTemplate(content)}`;
	}
};

// Checkbox template made with categories list
const categoriesTemplate = categories => {

	console.log(countCategoryValues);
	return `
	  <ul class="filter-options">	
		  ${categories.map((category, i) => {
			return `<li><input type="checkbox" id="categories" onchange="handleChangeCategory(this)" name="${category}" 
				  value="${category}">${category} <span class="product-present">${countCategoryValues[i]}</span</li>`})
		.join('')
		}
	  </ul>`
}

// Product List Template
const productListTemplate = (data) => {
	return `
	  ${data.map(product => {
		return `
			  <div class="product-detail">
				  <h2 class="product-heading">${product.name}</h2>
				  <p class="product-description">${product.description}</p>
			  </div>
		  `
	}).join('')}
  `
};

const calculateCurrentBrands = (content) => {
	let countContentBrands = {};
	let currentBrand = [];
	content.map(data => {
		currentBrand.push(data.brand);
	});
	currentBrand.forEach(x => countContentBrands[x] = (countContentBrands[x] || 0)+1 );
	return countContentBrands;
};

const brandTemplate = (countBrandObject) => {
	let keys = Object.keys(countBrandObject);
	let values = Object.values(countBrandObject);

	//console.log(keys,values);
    return `
	  <ul class="filter-options">
		  ${keys.map((eachBrand, i) => {
		  	//console.log(eachBrand);
        return `<li><input type="checkbox" onchange="handleChangeBrand(this)" name="${eachBrand}" 
				  value="${eachBrand}">${eachBrand} <span id="product-present">${values[i] ? values[i] : '0'}</span</li>`})
        .join('')
        }
	  </ul>`
};

document.getElementById("category-list").innerHTML = `${categoriesTemplate(category)}`;
document.getElementById("brand-list").innerHTML = `${brandTemplate(countBrandObject)}`;
document.getElementById("product-list").innerHTML = `${productListTemplate(dataSlice)}`;
